rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Rules for ticket attachments
    match /attachments/{ticketId}/{fileName} {
      // Allow public read access so anyone can see the files.
      allow read;

      // Allow writes only under specific conditions:
      // 1. If the user is authenticated (i.e., a support agent).
      // 2. Or, for unauthenticated users (customers), if the file is an image or PDF
      //    and is smaller than 5MB. This prevents abuse.
      allow write: if request.auth != null || (
        request.resource.size < 5 * 1024 * 1024 &&
        request.resource.contentType.matches('image/.*|application/pdf')
      );
    }
  }
}
